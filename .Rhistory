source('~/.active-rstudio-document', echo=TRUE)
source('~/.active-rstudio-document', echo=TRUE)
cov.plot(IT_five_year.synth, IT_five_year)
source('~/.active-rstudio-document', echo=TRUE)
cov.plot(IT_five_year.synth, IT_five_year)
source('~/.active-rstudio-document', echo=TRUE)
cov.plot(IT_five_year.synth, IT_five_year)
dataprep
# pick v by cross-validation
# data setup for training model
SynthCrossVal <- function(foo = NULL,
predictors = NULL,
predictors.op = "mean",
special.predictors = NULL,
dependent = NULL,
unit.variable = NULL,
time.variable = NULL,
treatment.identifier = NULL,
controls.identifier = NULL,
time.training = NULL,
time.validation = NULL,
time.optimize.final = NULL,
time.plot = time.optimize.final,
unit.names.variable = NA,
...
){
dataprep.training <- dataprep(foo = foo,
predictors = predictors,
predictors.op = predictors.op,
special.predictors = special.predictors,
dependent = dependent,
unit.variable = unit.variable,
time.variable = time.variable,
treatment.identifier = treatment.identifier,
controls.identifier = controls.identifier,
time.predictors.prior = time.training,
time.optimize.ssr = time.validation,
time.plot = time.plot,
unit.names.variable = unit.names.variable
)
synth.training <- synth(dataprep.training, ...)
dataprep.final <- dataprep(foo = foo,
predictors = predictors,
predictors.op = predictors.op,
special.predictors = special.predictors,
dependent = dependent,
unit.variable = unit.variable,
time.variable = time.variable,
treatment.identifier = treatment.identifier,
controls.identifier = controls.identifier,
time.predictors.prior = time.validation,
time.optimize.ssr = time.optimize.final,
time.plot = time.plot,
unit.names.variable = unit.names.variable)
synth.final <- synth(dataprep.final, custom.v = as.numeric(synth.training$solution.v))
return(list(dataprep.training = dataprep.training, synth.training = synth.training, dataprep.final = dataprep.final, synth.final = synth.final))
}
IT_CV <- SynthCrossVal(foo = IT,
predictors = Analysis_controls,
special.predictors = list(list("outcome", 1989, "mean")),
dependent = "outcome",
unit.variable = "CC",
time.variable = "yr",
treatment.identifier = 11,
controls.identifier = unique(IT$CC[ ! IT$CC %in% c(11) ]),
time.training = seq(1964, 1974, 5),
time.validation = seq(1979, 1989, 5),
time.optimize.final = seq(1954, 1989, 5),
time.plot = seq(1949, 1999, 5),
unit.names.variable = 2
)
Analysis_controls
IT_CV <- SynthCrossVal(foo = IT,
predictors = Analysis_controls[-6],
special.predictors = list(list("outcome", 1989, "mean")),
dependent = "outcome",
unit.variable = "CC",
time.variable = "yr",
treatment.identifier = 11,
controls.identifier = unique(IT$CC[ ! IT$CC %in% c(11) ]),
time.training = seq(1964, 1974, 5),
time.validation = seq(1979, 1989, 5),
time.optimize.final = seq(1954, 1989, 5),
time.plot = seq(1949, 1999, 5),
unit.names.variable = 2
)
SynthSummary(IT_CV[[3]], IT_CV[[4]], 1994)
IT_CV <- SynthCrossVal(foo = IT,
predictors = Analysis_controls[-6],
dependent = "outcome",
unit.variable = "CC",
time.variable = "yr",
treatment.identifier = 11,
controls.identifier = unique(IT$CC[ ! IT$CC %in% c(11) ]),
time.training = seq(1964, 1974, 5),
time.validation = seq(1979, 1989, 5),
time.optimize.final = seq(1954, 1989, 5),
time.plot = seq(1949, 1999, 5),
unit.names.variable = 2
)
SynthSummary(IT_CV[[3]], IT_CV[[4]], 1994)
IT_CV <- SynthCrossVal(foo = IT,
predictors = Analysis_controls[-6],
dependent = "outcome",
unit.variable = "CC",
time.variable = "yr",
treatment.identifier = 11,
controls.identifier = unique(IT$CC[ ! IT$CC %in% c(11) ]),
time.training = seq(1959, 1969, 5),
time.validation = seq(1979, 1989, 5),
time.optimize.final = seq(1954, 1989, 5),
time.plot = seq(1949, 1999, 5),
unit.names.variable = 2
)
SynthSummary(IT_CV[[3]], IT_CV[[4]], 1994)
IT_CV <- SynthCrossVal(foo = IT,
predictors = Analysis_controls[-c(6,7)],
dependent = "outcome",
unit.variable = "CC",
time.variable = "yr",
treatment.identifier = 11,
controls.identifier = unique(IT$CC[ ! IT$CC %in% c(11) ]),
time.training = seq(1959, 1969, 5),
time.validation = seq(1979, 1989, 5),
time.optimize.final = seq(1954, 1989, 5),
time.plot = seq(1949, 1999, 5),
unit.names.variable = 2
)
SynthSummary(IT_CV[[3]], IT_CV[[4]], 1994)
IT_CV <- SynthCrossVal(foo = IT,
predictors = Analysis_controls[-c(6,7)],
dependent = "outcome",
unit.variable = "CC",
time.variable = "yr",
treatment.identifier = 11,
controls.identifier = unique(IT$CC[ ! IT$CC %in% c(11) ]),
time.training = seq(1959, 1979, 5),
time.validation = seq(1984, 1989, 5),
time.optimize.final = seq(1954, 1989, 5),
time.plot = seq(1949, 1999, 5),
unit.names.variable = 2
)
SynthSummary(IT_CV[[3]], IT_CV[[4]], 1994)
IT_CV <- SynthCrossVal(foo = IT,
predictors = Analysis_controls[-c(3,6,7)],
dependent = "outcome",
unit.variable = "CC",
time.variable = "yr",
treatment.identifier = 11,
controls.identifier = unique(IT$CC[ ! IT$CC %in% c(11) ]),
time.training = seq(1959, 1979, 5),
time.validation = seq(1984, 1989, 5),
time.optimize.final = seq(1954, 1989, 5),
time.plot = seq(1949, 1999, 5),
unit.names.variable = 2
)
SynthSummary(IT_CV[[3]], IT_CV[[4]], 1994)
IT_CV <- SynthCrossVal(foo = IT,
predictors = Analysis_controls[-c(3,6,7)],
dependent = "outcome",
unit.variable = "CC",
time.variable = "yr",
treatment.identifier = 11,
controls.identifier = unique(IT$CC[ ! IT$CC %in% c(11) ]),
time.training = seq(1964, 1974, 5),
time.validation = seq(1979, 1989, 5),
time.optimize.final = seq(1954, 1989, 5),
time.plot = seq(1949, 1999, 5),
unit.names.variable = 2
)
SynthSummary(IT_CV[[3]], IT_CV[[4]], 1994)
path.plot(IT_CV[[3]], IT_CV[[4]], 1994)
path.plot
path.plot(IT_CV[[4]], IT_CV[[3]], 1994)
path.plot(IT_CV[[4]], IT_CV[[3]], 1994)
IT_CV <- SynthCrossVal(foo = IT,
predictors = Analysis_controls[-c(3,6,7)],
dependent = "outcome",
unit.variable = "CC",
time.variable = "yr",
treatment.identifier = 11,
controls.identifier = unique(IT$CC[ ! IT$CC %in% c(11) ]),
time.training = seq(1974, 1979, 5),
time.validation = seq(1984, 1989, 5),
time.optimize.final = seq(1954, 1989, 5),
time.plot = seq(1949, 1999, 5),
unit.names.variable = 2
)
path.plot(IT_CV[[4]], IT_CV[[3]], 1994)
SynthSummary(IT_CV[[3]], IT_CV[[4]], 1994)
IT_CV <- SynthCrossVal(foo = IT,
predictors = Analysis_controls[-c(6)],
dependent = "outcome",
unit.variable = "CC",
time.variable = "yr",
treatment.identifier = 11,
controls.identifier = unique(IT$CC[ ! IT$CC %in% c(11) ]),
time.training = seq(1974, 1979, 5),
time.validation = seq(1984, 1989, 5),
time.optimize.final = seq(1954, 1989, 5),
time.plot = seq(1949, 1999, 5),
unit.names.variable = 2
)
SynthSummary(IT_CV[[3]], IT_CV[[4]], 1994)
path.plot(IT_CV[[4]], IT_CV[[3]], 1994)
IT_CV <- SynthCrossVal(foo = IT,
predictors = Analysis_controls[-c(6,9)],
dependent = "outcome",
unit.variable = "CC",
time.variable = "yr",
treatment.identifier = 11,
controls.identifier = unique(IT$CC[ ! IT$CC %in% c(11) ]),
time.training = seq(1974, 1979, 5),
time.validation = seq(1984, 1989, 5),
time.optimize.final = seq(1954, 1989, 5),
time.plot = seq(1949, 1999, 5),
unit.names.variable = 2
)
SynthSummary(IT_CV[[3]], IT_CV[[4]], 1994)
path.plot(IT_CV[[4]], IT_CV[[3]], 1994)
IT_CV <- SynthCrossVal(foo = IT,
predictors = Analysis_controls,
dependent = "outcome",
unit.variable = "CC",
time.variable = "yr",
treatment.identifier = 11,
controls.identifier = unique(IT$CC[ ! IT$CC %in% c(11) ]),
time.training = seq(1954, 1979, 5),
time.validation = seq(1984, 1989, 5),
time.optimize.final = seq(1954, 1989, 5),
time.plot = seq(1949, 1999, 5),
unit.names.variable = 2
)
SynthSummary(IT_CV[[3]], IT_CV[[4]], 1994)
path.plot(IT_CV[[4]], IT_CV[[3]], 1994)
IT_CV <- SynthCrossVal(foo = IT,
predictors = Analysis_controls,
dependent = "outcome",
unit.variable = "CC",
time.variable = "yr",
treatment.identifier = 11,
controls.identifier = unique(IT$CC[ ! IT$CC %in% c(11) ]),
time.training = seq(1954, 1969, 5),
time.validation = seq(1974, 1989, 5),
time.optimize.final = seq(1954, 1989, 5),
time.plot = seq(1949, 1999, 5),
unit.names.variable = 2
)
IT_CV <- SynthCrossVal(foo = IT,
predictors = Analysis_controls[-6],
dependent = "outcome",
unit.variable = "CC",
time.variable = "yr",
treatment.identifier = 11,
controls.identifier = unique(IT$CC[ ! IT$CC %in% c(11) ]),
time.training = seq(1954, 1969, 5),
time.validation = seq(1974, 1989, 5),
time.optimize.final = seq(1954, 1989, 5),
time.plot = seq(1949, 1999, 5),
unit.names.variable = 2
)
SynthSummary(IT_CV[[3]], IT_CV[[4]], 1994)
path.plot(IT_CV[[4]], IT_CV[[3]], 1994)
IT_CV <- SynthCrossVal(foo = IT,
predictors = Analysis_controls[-6],
dependent = "outcome",
unit.variable = "CC",
time.variable = "yr",
treatment.identifier = 11,
controls.identifier = unique(IT$CC[ ! IT$CC %in% c(11) ]),
time.training = seq(1954, 1969, 5),
time.validation = seq(1974, 1989, 5),
time.optimize.final = seq(1949, 1989, 5),
time.plot = seq(1949, 1999, 5),
unit.names.variable = 2
)
SynthSummary(IT_CV[[3]], IT_CV[[4]], 1994)
path.plot(IT_CV[[4]], IT_CV[[3]], 1994)
IT_CV <- SynthCrossVal(foo = IT,
predictors = Analysis_controls[-6],
dependent = "outcome",
unit.variable = "CC",
time.variable = "yr",
treatment.identifier = 17,
controls.identifier = unique(IT$CC[ ! IT$CC %in% c(17) ]),
time.training = seq(1954, 1969, 5),
time.validation = seq(1974, 1989, 5),
time.optimize.final = seq(1949, 1989, 5),
time.plot = seq(1949, 1999, 5),
unit.names.variable = 2
)
SynthSummary(IT_CV[[3]], IT_CV[[4]], 1994)
path.plot(IT_CV[[4]], IT_CV[[3]], 1994)
IT_CV <- SynthCrossVal(foo = IT,
predictors = Analysis_controls[-6],
dependent = "outcome",
unit.variable = "CC",
time.variable = "yr",
treatment.identifier = 17,
controls.identifier = unique(IT$CC[ ! IT$CC %in% c(17) ]),
time.training = seq(1954, 1969, 5),
time.validation = seq(1974, 1989, 5),
time.optimize.final = seq(1954, 1989, 5),
time.plot = seq(1949, 1999, 5),
unit.names.variable = 2
)
path.plot(IT_CV[[4]], IT_CV[[3]], 1994)
SynthSummary(IT_CV[[3]], IT_CV[[4]], 1994)
IT_CV <- SynthCrossVal(foo = IT,
predictors = Analysis_controls[c(1,4,5)],
dependent = "outcome",
unit.variable = "CC",
time.variable = "yr",
treatment.identifier = 17,
controls.identifier = unique(IT$CC[ ! IT$CC %in% c(17) ]),
time.training = seq(1954, 1969, 5),
time.validation = seq(1974, 1989, 5),
time.optimize.final = seq(1954, 1989, 5),
time.plot = seq(1949, 1999, 5),
unit.names.variable = 2
)
IT_CV <- SynthCrossVal(foo = IT,
SynthSummary(IT_CV[[3]], IT_CV[[4]], 1994)
path.plot(IT_CV[[4]], IT_CV[[3]], 1994)
IT_CV <- SynthCrossVal(foo = IT,
predictors = Analysis_controls[c(1,2,4,5)],
dependent = "outcome",
unit.variable = "CC",
time.variable = "yr",
treatment.identifier = 17,
controls.identifier = unique(IT$CC[ ! IT$CC %in% c(17) ]),
time.training = seq(1954, 1969, 5),
time.validation = seq(1974, 1989, 5),
time.optimize.final = seq(1954, 1989, 5),
time.plot = seq(1949, 1999, 5),
unit.names.variable = 2
)
SynthSummary(IT_CV[[3]], IT_CV[[4]], 1994)
path.plot(IT_CV[[4]], IT_CV[[3]], 1994)
IT_CV <- SynthCrossVal(foo = IT,
predictors = Analysis_controls[c(1,2,4,5)],
dependent = "outcome",
unit.variable = "CC",
time.variable = "yr",
treatment.identifier = 11,
controls.identifier = unique(IT$CC[ ! IT$CC %in% c(11) ]),
time.training = seq(1954, 1969, 5),
time.validation = seq(1974, 1989, 5),
time.optimize.final = seq(1954, 1989, 5),
time.plot = seq(1949, 1999, 5),
unit.names.variable = 2
)
SynthSummary(IT_CV[[3]], IT_CV[[4]], 1994)
path.plot(IT_CV[[4]], IT_CV[[3]], 1994)
IT_CV <- SynthCrossVal(foo = IT,
predictors = Analysis_controls[c(1,2,4,5)],
dependent = "outcome",
unit.variable = "CC",
time.variable = "yr",
treatment.identifier = 11,
controls.identifier = unique(IT$CC[ ! IT$CC %in% c(11) ]),
time.training = seq(1954, 1969, 5),
time.validation = seq(1974, 1989, 5),
time.optimize.final = seq(1954, 1989, 5),
time.plot = seq(1974, 1999, 5),
unit.names.variable = 2
)
SynthSummary(IT_CV[[3]], IT_CV[[4]], 1994)
path.plot(IT_CV[[4]], IT_CV[[3]], 1994)
getSlots("MultiSynth")
fitMultiSynth
data(synth.data)
dataprep.out<-
#'  dataprep(
#'    foo = synth.data,
#'    predictors = c("X1", "X2", "X3"),
#'    predictors.op = "mean",
#'    dependent = "Y",
#'    unit.variable = "unit.num",
#'    time.variable = "year",
#'    special.predictors = list(
#'      list("Y", 1991, "mean"),
#'      list("Y", 1985, "mean"),
#'      list("Y", 1980, "mean")
#'    ),
#'    treatment.identifier = 7,
#'    controls.identifier = c(29, 2, 13, 17, 32, 38),
#'    time.predictors.prior = c(1984:1989),
#'    time.optimize.ssr = c(1984:1990),
#'    unit.names.variable = "name",
#'    time.plot = 1984:1996
#'  )
dataprep.out<-
dataprep(
foo = synth.data,
predictors = c("X1", "X2", "X3"),
predictors.op = "mean",
dependent = "Y",
unit.variable = "unit.num",
time.variable = "year",
special.predictors = list(
list("Y", 1991, "mean"),
list("Y", 1985, "mean"),
list("Y", 1980, "mean")
),
treatment.identifier = 7,
controls.identifier = c(29, 2, 13, 17, 32, 38),
time.predictors.prior = c(1984:1989),
time.optimize.ssr = c(1984:1990),
unit.names.variable = "name",
time.plot = 1984:1996
)
fitMultiSynth.out <- fitMultiSynth(dataprep.out, treatment_time = 1990)
lists and objects.
fitMultiSynth.out
summary(fitMultiSynth.out)
fitMultiSynth.out <- fitMultiSynth(dataprep.out, treatment_time = 1991)
summary(fitMultiSynth.out)
plot(fitMultiSynth.out)
plot(fitMultiSynth.out, quantity = "ATE")
gaps.plot(fitMultiSynth.out)
fitMultiSynth.out <- fitMultiSynth(dataprep.out, treatment_time = 1990)
gaps.plot(fitMultiSynth.out)
plot(fitMultiSynth.out, quantity = "ATE")
summary(fitMultiSynth.out)
fitMultiSynth.out <- fitMultiSynth(dataprep.out, type = "units", treatment_time = 1990)
summary(fitMultiSynth.out)
plot(fitMultiSynth.out, quantity = "ATE")
gaps.plot(fitMultiSynth.out)
fitMultiSynth.out <- fitMultiSynth(dataprep.out, type = "units", treatment_time = 1992)
gaps.plot(fitMultiSynth.out)
plot(fitMultiSynth.out, quantity = "ATE")
summary(fitMultiSynth.out)
source('~/.active-rstudio-document', echo=TRUE)
fitMultiSynth.out <- fitMultiSynth(dataprep.out, type = "units", treatment_time = 1992)
getTreated(fitMultiSynth.out)
getTreated(try1)
getTreated(try2)
getTreated(try3)
rnorm(100)/rnorm(100)
runif(100,0,1)
runif(100,0,1)/runif(100,0,1)
hist(runif(100,0,1)/runif(100,0,1))
hist(log(runif(100,0,1)/runif(100,0,1)))
hist(log(runif(100,0,1)/runif(100,0,1)))
source('~/.active-rstudio-document', echo=TRUE)
source('~/.active-rstudio-document', echo=TRUE)
install.packages(c("devtools", "roxygen2"))
library(devtools)
library(roxygen2)
create("/code/synthTOOLS/synthTools")
create("/Code/synthTOOLS/synthTools")
create("synthTools")
setwd("~/Code/synthTOOLS")
setwd("~Documents/Washu 2nd YEar/Causal Inference/Research Project/Code/synthTOOLS")
setwd("~Documents/Washu 2nd Year/Causal Inference/Research Project/Code/synthTOOLS")
setwd("~Documents/Washu 2nd Year/Causal Inference/Research Project/Code/synthTOOLS/")
setwd("~Documents/Washu 2nd Year/Causal Inference/Research Project/Code/")
getwd()
setwd("/Users/clockbob1/Documents/WashU 2nd Year/Causal Inference/Research Project/Code")
setwd("/Users/clockbob1/Documents/WashU 2nd Year/Causal Inference/Research Project/Code/synthTOOLS")
current.code <- as.package("synthTools")
load_all(current.code)
current.code <- as.package("synthTools")
load_all(current.code)
gaps.plot
load_all(current.code)
load_all(current.code)
current.code <- as.package("synthTools")
load_all(current.code)
current.code <- as.package("synthTools")
load_all(current.code)
current.code <- as.package("synthTools")
load_all(current.code)
current.code <- as.package("synthTools")
load_all(current.code)
current.code <- as.package("synthTools")
load_all(current.code)
current.code <- as.package("synthTools")
load_all(current.code)
document(current.code)
current.code <- as.package("synthTools")
load_all(current.code)
current.code <- as.package("synthTools")
load_all(current.code)
current.code <- as.package("synthTools")
load_all(current.code)
current.code <- as.package("synthTools")
load_all(current.code)
current.code <- as.package("synthTools")
load_all(current.code)
current.code <- as.package("synthTools")
load_all(current.code)
current.code <- as.package("synthTools")
load_all(current.code)
source('~/.active-rstudio-document', echo=TRUE)
source('~/.active-rstudio-document', echo=TRUE)
setMethod(f = "gaps.plot",
signature = "MultiSynth",
def = function(synth.res = NA, dataprep.res = NA, Ylab = c("Title"), Xlab = c("Time"), Main = c("Gaps: Treated - Synthetic"), tr.intake = NA, Ylim = NA, Z.plot = FALSE){
#prep additional lines
plot_prep <- MultiSynthGapPlotPrep(synth.res@preps[2:length(synth.res@preps)], synth.res@fits[2:length(synth.res@fits)] )
Max_gap <- max(abs(synth.res@input$Y1plot - (synth.res@input$Y0plot %*% synth.res@fits[[1]]$solution.w)))
y_lim_gaps <- if(any(sapply(plot_prep, function(list){ max(abs(list$y.info)) > Max_gap})) ){max(sapply(plot_prep, function(list){ max(abs(list$y.info) )} ) ) }  else { Max_gap}
y_lim_final <- if(is.na(Ylim[1])){c(-1*(y_lim_gaps + .3*y_lim_gaps), y_lim_gaps + .3*y_lim_gaps)} else {Ylim}
#plot the basic thing
gaps.plot(synth.res@fits[[1]], synth.res@input, synth.res@treatment_time, Ylab = Ylab, Xlab= Xlab, Ylim = y_lim_final, Main = Main, Z.plot = Z.plot)
#plot new lines
MultiSynthPlotLines(plot_prep)
return(invisible())
}
)
